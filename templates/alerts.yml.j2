groups:
  - name: caddy_alerts
    rules:
      - alert: CaddyServerDown
        expr: up{job="caddy"} == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Caddy web server is down"
          description: "Caddy has been down for more than 30 seconds."

      - alert: HighErrorRate
        expr: rate(caddy_http_response_duration_seconds_count{code=~"5.."}[1m]) > 0
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "High HTTP 5xx error rate"
          description: "Caddy is returning 5xx errors."

      - alert: SlowResponses
        expr: |
          rate(caddy_http_request_duration_seconds_sum[1m]) 
          / rate(caddy_http_request_duration_seconds_count[1m]) > 0.5
          and rate(caddy_http_request_duration_seconds_count[1m]) > 0
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "High latency detected"
          description: "Average request latency is above 0.5s."

      - alert: HighRequestRate
        expr: rate(caddy_http_requests_total[1m]) > 100
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "High request rate"
          description: "More than 100 requests/sec for 1 minute."
