groups:
  - name: gridscale_hiring_alerts
    rules:
      - alert: CaddyServerDown
        expr: up{job="caddy"} == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Caddy web server is down"
          description: "Instance {{ '{{' }} $labels.instance {{ '}}' }} of job {{ '{{' }} $labels.job {{ '}}' }} has been down for more than 30 seconds."

      - alert: HighErrorRate
        expr: rate(caddy_http_response_duration_seconds_count{status=~"5.."}[1m]) > 0
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "High HTTP 5xx Error Rate"
          description: "Caddy is returning 5xx errors."

      - alert: SlowResponses
        # Alerts if average latency is > 500ms over 1 minute
        expr: rate(caddy_http_request_duration_seconds_sum[1m]) / rate(caddy_http_request_duration_seconds_count[1m]) > 0.5
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "High Latency detected"
          description: "Average request latency is above 0.5s."

      - alert: HighRequestRate
        expr: rate(caddy_http_requests_total[1m]) > 100
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "High request rate detected"
          description: "More than 100 requests/sec for 1 minute."
